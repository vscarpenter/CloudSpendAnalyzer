# AWS Cost Explorer CLI - User Guide

This comprehensive guide will help you master the AWS Cost Explorer CLI tool and get the most value from your AWS cost analysis.

## Table of Contents

1. [Getting Started](#getting-started)
2. [Basic Query Patterns](#basic-query-patterns)
3. [Service-Specific Examples](#service-specific-examples)
4. [Time-Based Analysis](#time-based-analysis)
5. [Advanced Query Techniques](#advanced-query-techniques)
6. [Configuration and Optimization](#configuration-and-optimization)
7. [Troubleshooting](#troubleshooting)
8. [Best Practices](#best-practices)

## Getting Started

### Prerequisites

Before using the AWS Cost Explorer CLI, ensure you have:

1. **AWS CLI configured** with appropriate permissions
2. **Cost Explorer enabled** in your AWS account (may incur charges)
3. **LLM provider configured** (OpenAI, Anthropic, Bedrock, or Ollama)
4. **Python 3.8+** installed

### First Query

Start with a simple query to verify everything is working:

```bash
aws-cost-cli query "What did I spend on AWS last month?"
```

This basic query will:
- Test your AWS credentials
- Verify your LLM provider configuration
- Show your overall AWS spending for the previous month

## Basic Query Patterns

### Understanding Query Structure

The CLI accepts natural language queries, but certain patterns work better:

**Good Query Patterns:**
- "How much did I spend on [SERVICE] [TIME_PERIOD]?"
- "Show me [SERVICE] costs for [TIME_PERIOD]"
- "What are my top spending services [TIME_PERIOD]?"
- "Compare [SERVICE1] vs [SERVICE2] costs [TIME_PERIOD]"

**Time Period Examples:**
- "last month", "this month", "last 3 months"
- "2024", "last year", "this year"
- "January 2024", "Q1 2024"
- "last 30 days", "last week"

### Service Breakdown Queries

Get detailed breakdowns of your AWS spending by service:

```bash
# List all services you used with costs
aws-cost-cli query "What services did I use last month in my AWS account that cost me money?"

# Alternative phrasing for service breakdown
aws-cost-cli query "Can you list the services I used last month that cost me money?"

# Show service breakdown for specific time periods
aws-cost-cli query "Show me all AWS services I used this year with their costs"

# Service breakdown with different time ranges
aws-cost-cli query "Which services did I spend money on last quarter?"
```

**Example Output:**
```
AWS Cost Summary (2025-07-01 to 2025-08-01)
===========================================

Total Cost: $26.32

Service Breakdown:
--------------------
  Amazon Elastic Compute Cloud - Compute: $15.50
  Amazon Simple Storage Service: $8.25
  AWS Lambda: $2.57
```

### Output Formats

Control how results are displayed:

```bash
# Simple format (default) - clean text output
aws-cost-cli query "What did I spend on AWS last month?"

# Rich format - enhanced terminal output with colors and formatting
aws-cost-cli query "What did I spend on AWS last month?" --format rich

# LLM format - natural language response generated by AI
aws-cost-cli query "What did I spend on AWS last month?" --format llm

# JSON format - structured data for scripting and automation
aws-cost-cli query "What did I spend on AWS last month?" --format json
```

**Note:** If a query returns $0.00, it may indicate:
- No costs for the specified service/time period
- The service name needs to be more specific (try "What did I spend on compute services?" instead of "EC2 costs")
- Your AWS account doesn't have Cost Explorer data for that period

## Service-Specific Examples

### 1. Amazon EC2 (Elastic Compute Cloud)

```bash
# Basic EC2 spending
aws-cost-cli query "What did I spend on EC2 last month?"

# Alternative if EC2 doesn't work
aws-cost-cli query "What did I spend on compute services last month?"

# EC2 instance type breakdown
aws-cost-cli query "Show me compute costs by instance type for 2024"

# EC2 regional analysis
aws-cost-cli query "What are my compute costs by region last quarter?"

# EC2 vs EBS comparison
aws-cost-cli query "Compare compute costs vs storage costs this year"
```

### 2. Amazon S3 (Simple Storage Service)

```bash
# S3 storage costs
aws-cost-cli query "What did I spend on S3 storage last month?"

# S3 data transfer costs
aws-cost-cli query "Show me S3 data transfer costs for the last 6 months"

# S3 storage class breakdown
aws-cost-cli query "Break down my S3 costs by storage class this year"

# S3 vs Glacier comparison
aws-cost-cli query "Compare S3 Standard vs Glacier costs annually"
```

### 3. Amazon RDS (Relational Database Service)

```bash
# RDS database costs
aws-cost-cli query "How much am I spending on RDS databases monthly?"

# RDS engine comparison
aws-cost-cli query "Compare MySQL vs PostgreSQL RDS costs this year"

# RDS instance size analysis
aws-cost-cli query "Show RDS costs by instance size last quarter"

# RDS backup and snapshot costs
aws-cost-cli query "What are my RDS backup and snapshot costs this month?"
```

### 4. AWS Lambda

```bash
# Lambda execution costs
aws-cost-cli query "What did I spend on Lambda last month?"

# Lambda vs EC2 cost comparison
aws-cost-cli query "Compare Lambda vs EC2 costs for compute workloads this year"

# Lambda request and duration breakdown
aws-cost-cli query "Break down Lambda costs by requests vs duration last quarter"
```

### 5. Amazon CloudFront

```bash
# CloudFront distribution costs
aws-cost-cli query "Show me CloudFront costs for the last 3 months"

# CloudFront data transfer analysis
aws-cost-cli query "What are my CloudFront data transfer costs by region this year?"

# CloudFront vs direct S3 serving
aws-cost-cli query "Compare CloudFront vs direct S3 serving costs annually"
```

### 6. Amazon EKS (Elastic Kubernetes Service)

```bash
# EKS cluster costs
aws-cost-cli query "How much am I spending on EKS clusters monthly?"

# EKS vs self-managed Kubernetes costs
aws-cost-cli query "What are the cost differences between EKS and EC2-based Kubernetes?"

# EKS node group analysis
aws-cost-cli query "Break down EKS costs by node groups last month"
```

### 7. Amazon Redshift

```bash
# Redshift cluster costs
aws-cost-cli query "What did I spend on Redshift last quarter?"

# Redshift vs RDS cost comparison
aws-cost-cli query "Compare Redshift vs RDS costs for data warehousing this year"

# Redshift reserved vs on-demand
aws-cost-cli query "Show Redshift reserved instance vs on-demand costs"
```

### 8. Amazon ElastiCache

```bash
# ElastiCache costs
aws-cost-cli query "How much am I spending on ElastiCache monthly?"

# Redis vs Memcached comparison
aws-cost-cli query "Compare ElastiCache Redis vs Memcached costs this year"

# ElastiCache node type analysis
aws-cost-cli query "Break down ElastiCache costs by node type last month"
```

### 9. Amazon API Gateway

```bash
# API Gateway costs
aws-cost-cli query "What are my API Gateway costs last month?"

# API Gateway request volume analysis
aws-cost-cli query "Show API Gateway costs by request volume this quarter"

# REST vs HTTP API cost comparison
aws-cost-cli query "Compare REST API vs HTTP API costs in API Gateway"
```

### 10. Amazon DynamoDB

```bash
# DynamoDB costs
aws-cost-cli query "How much did I spend on DynamoDB last month?"

# DynamoDB on-demand vs provisioned
aws-cost-cli query "Compare DynamoDB on-demand vs provisioned capacity costs this year"

# DynamoDB read vs write costs
aws-cost-cli query "Break down DynamoDB costs by read vs write operations"
```

## Time-Based Analysis

### Annual Spending Analysis

```bash
# Total annual spending
aws-cost-cli query "What was my total AWS spending for 2024?"

# Year-over-year comparison
aws-cost-cli query "Compare my AWS spending between 2023 and 2024"

# Annual spending by service
aws-cost-cli query "Show me my top 10 AWS services by annual spending in 2024"

# Annual growth analysis
aws-cost-cli query "Which services had the highest cost growth in 2024?"

# Annual cost optimization opportunities
aws-cost-cli query "What are my biggest cost optimization opportunities based on 2024 spending?"
```

### Monthly Spending Patterns

```bash
# Current month spending
aws-cost-cli query "How much have I spent on AWS this month so far?"

# Month-over-month comparison
aws-cost-cli query "Compare this month's AWS spending to last month"

# Monthly spending trend
aws-cost-cli query "Show my monthly AWS spending trend for the last 12 months"

# Seasonal spending patterns
aws-cost-cli query "What are my seasonal AWS spending patterns over the last 2 years?"

# Monthly budget tracking
aws-cost-cli query "Am I on track to meet my monthly AWS budget of $5000?"
```

### Quarterly Analysis

```bash
# Quarterly spending summary
aws-cost-cli query "What was my AWS spending for Q4 2024?"

# Quarter-over-quarter growth
aws-cost-cli query "Compare Q4 2024 spending to Q3 2024"

# Quarterly service breakdown
aws-cost-cli query "Show me quarterly spending breakdown by service for 2024"

# Quarterly cost trends
aws-cost-cli query "What are the quarterly cost trends for my top 5 AWS services?"
```

### Daily and Weekly Analysis

```bash
# Daily spending patterns
aws-cost-cli query "Show me daily AWS spending for the last 30 days"

# Weekly spending trends
aws-cost-cli query "What are my weekly AWS spending patterns this month?"

# Weekend vs weekday costs
aws-cost-cli query "Compare weekend vs weekday AWS costs last month"

# Daily cost spikes
aws-cost-cli query "Which days had the highest AWS costs last month?"
```

## Advanced Query Techniques

### Multi-Service Comparisons

```bash
# Top spending services
aws-cost-cli query "What are my top 10 AWS services by cost this year?"

# Service cost distribution
aws-cost-cli query "Show me the percentage breakdown of costs by AWS service"

# Compute services comparison
aws-cost-cli query "Compare costs between EC2, Lambda, and EKS this quarter"

# Storage services comparison
aws-cost-cli query "Compare S3, EBS, and EFS storage costs annually"
```

### Regional Analysis

```bash
# Multi-region cost breakdown
aws-cost-cli query "Show me AWS costs by region for the last 6 months"

# Regional cost comparison
aws-cost-cli query "Compare costs between us-east-1 and eu-west-1 this year"

# Data transfer costs by region
aws-cost-cli query "What are my inter-region data transfer costs?"

# Regional optimization opportunities
aws-cost-cli query "Which regions offer the best cost optimization opportunities?"
```

### Cost Optimization Queries

```bash
# Unused resources identification
aws-cost-cli query "Help me identify potentially unused AWS resources based on cost patterns"

# Reserved instance analysis
aws-cost-cli query "Show me potential savings from reserved instances"

# Right-sizing opportunities
aws-cost-cli query "What are my EC2 right-sizing opportunities based on cost analysis?"

# Cost anomaly detection
aws-cost-cli query "Were there any unusual cost spikes last month?"
```

### Budget and Forecasting

```bash
# Cost forecasting
aws-cost-cli query "Based on current trends, what will my AWS costs be next month?"

# Budget variance analysis
aws-cost-cli query "How does my actual spending compare to my $10000 monthly budget?"

# Cost projection
aws-cost-cli query "Project my annual AWS costs based on the last 6 months"

# Service growth forecasting
aws-cost-cli query "Which services are likely to drive cost growth next quarter?"
```

## Configuration and Optimization

### Profile Management

```bash
# List available AWS profiles
aws-cost-cli list-profiles

# Use specific AWS profile
aws-cost-cli query "EC2 costs last month" --profile production

# Set default profile
aws-cost-cli configure --default-profile production
```

### Cache Management

```bash
# Clear cache for fresh data
aws-cost-cli cache clear

# Check cache status
aws-cost-cli cache status

# Set custom cache TTL (in seconds)
aws-cost-cli configure --cache-ttl 7200  # 2 hours
```

### LLM Provider Optimization

```bash
# Switch LLM providers for different use cases
aws-cost-cli configure --provider anthropic  # Better for complex analysis
aws-cost-cli configure --provider ollama     # For privacy-sensitive environments
aws-cost-cli configure --provider bedrock    # For AWS-native integration

# Test LLM provider performance
aws-cost-cli test --provider openai
```

## Troubleshooting

### Common Issues and Solutions

#### 1. Authentication Errors

```bash
# Verify AWS credentials
aws sts get-caller-identity

# Check AWS profile configuration
aws-cost-cli list-profiles

# Test with specific profile
aws-cost-cli query "test query" --profile your-profile-name
```

#### 2. LLM Provider Issues

```bash
# Test LLM connectivity
aws-cost-cli test

# Check API key configuration
aws-cost-cli config show

# Switch to alternative provider
aws-cost-cli configure --provider ollama  # Local fallback
```

#### 3. Cost Explorer Access

```bash
# Verify Cost Explorer permissions
aws ce get-cost-and-usage --time-period Start=2024-01-01,End=2024-01-02 --granularity MONTHLY --metrics BlendedCost

# Check if Cost Explorer is enabled
aws-cost-cli query "test access to cost data"
```

#### 4. Query Understanding Issues

```bash
# Use more specific queries with full context
aws-cost-cli query "What did I spend on EC2 last month?"  # Instead of "EC2 costs"

# Try alternative phrasing for better results
aws-cost-cli query "What did I spend on compute services last month?"

# Use complete questions rather than fragments
aws-cost-cli query "What are my S3 costs for last month?" --format rich
```

#### 5. Zero Cost Results ($0.00)

If you're getting $0.00 when you expect costs:

```bash
# Check if you have any AWS costs at all
aws-cost-cli query "What did I spend on AWS last month?"

# Try broader service categories
aws-cost-cli query "What did I spend on compute services last month?"  # Instead of specific "EC2"

# Check different time periods
aws-cost-cli query "What did I spend on AWS this year?"

# Verify with service breakdown
aws-cost-cli query "What services did I use last month that cost me money?"
```

### Debug Mode

```bash
# Enable verbose logging
aws-cost-cli query "EC2 costs" --debug

# Check configuration
aws-cost-cli config show --debug

# Test all components
aws-cost-cli test --debug
```

## Best Practices

### 1. Query Optimization

- **Be specific** with time periods and services
- **Use consistent terminology** (e.g., "last month" vs "previous month")
- **Start simple** and add complexity gradually
- **Cache frequently used queries** by running them regularly

### 2. Cost Analysis Workflow

1. **Start with overview**: "What did I spend on AWS last month?"
2. **Identify top services**: "What are my top 5 AWS services by cost?"
3. **Drill down**: "Show me EC2 costs by instance type"
4. **Compare periods**: "Compare this month to last month"
5. **Look for optimization**: "What are my cost optimization opportunities?"

### 3. Regular Monitoring

```bash
# Daily cost check
aws-cost-cli query "How much have I spent on AWS today?"

# Weekly summary
aws-cost-cli query "What was my AWS spending this week?"

# Monthly review
aws-cost-cli query "Show me monthly spending trends and top services"

# Quarterly planning
aws-cost-cli query "What are my quarterly cost trends and forecasts?"
```

### 4. Security and Privacy

- **Use environment variables** for API keys
- **Rotate API keys** regularly
- **Use Ollama** for sensitive environments
- **Limit AWS permissions** to Cost Explorer only
- **Review query logs** periodically

### 5. Performance Optimization

- **Use caching** for repeated queries
- **Batch similar queries** together
- **Choose appropriate LLM provider** for your use case
- **Monitor API usage** and costs

### 6. Team Collaboration

```bash
# Standardize queries across team
aws-cost-cli query "What are our monthly AWS costs by team tag?"

# Create reusable query patterns
aws-cost-cli query "Show development environment costs this month"

# Document common queries
aws-cost-cli query "Production vs staging cost comparison"
```

## Advanced Use Cases

### 1. Cost Allocation and Chargeback

```bash
# Department-based cost allocation
aws-cost-cli query "Show AWS costs by department tag for last quarter"

# Project-based billing
aws-cost-cli query "What are the costs for project Alpha this month?"

# Environment-based analysis
aws-cost-cli query "Compare production vs development environment costs"
```

### 2. Financial Planning

```bash
# Annual budget planning
aws-cost-cli query "Based on growth trends, what should our AWS budget be for 2025?"

# Cost center analysis
aws-cost-cli query "Show cost breakdown by business unit for financial reporting"

# ROI analysis
aws-cost-cli query "What are the cost trends for our revenue-generating services?"
```

### 3. Compliance and Reporting

```bash
# Monthly executive summary
aws-cost-cli query "Create an executive summary of AWS costs and trends this month"

# Audit trail
aws-cost-cli query "Show detailed cost breakdown for compliance reporting"

# Variance reporting
aws-cost-cli query "What are the significant cost variances from our budget this quarter?"
```

This user guide provides comprehensive coverage of the AWS Cost Explorer CLI capabilities. Start with basic queries and gradually explore more advanced features as you become comfortable with the tool. Remember that the natural language interface is flexible, so don't hesitate to experiment with different query phrasings to get the insights you need.